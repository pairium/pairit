# Config 2: Chat with AI agent
# Tests: P0-3 (SSE), P0-4 (Chat), P0-5 (AI agent), P0-6 (end-to-end)
# Status: Requires P0-3/4/5 to be implemented

schema_version: 0.1.0
initialPageId: intro

pages:
  - id: intro
    components:
      - type: text
        props:
          text: |
            # Negotiation Study

            You will negotiate the price of a used car with an AI assistant.
            Try to get the best deal you can. The AI has a reserve price it won't go below.
      - type: buttons
        props:
          buttons:
            - id: start
              text: "Start negotiation"
              action:
                type: go_to
                target: chat

  - id: chat
    components:
      - type: chat
        props:
          agents:
            - dealer
      - type: buttons
        props:
          buttons:
            - id: end_chat
              text: "End negotiation"
              highlightWhen: chat_ended
              action:
                type: go_to
                target: post_survey

  - id: post_survey
    components:
      - type: survey
        props:
          items:
            - id: final_price
              text: "What was the final agreed price (if any)?"
              answer: numeric
            - id: satisfaction
              text: "How satisfied are you with the outcome?"
              answer: likert5
            - id: strategy
              text: "Describe your negotiation strategy."
              answer: text
      - type: buttons
        props:
          buttons:
            - id: finish
              text: "Finish"
              action:
                type: go_to
                branches:
                  - when: "user_state.deal_reached == true"
                    target: outro_deal
                  - target: outro_no_deal

  - id: outro_deal
    end: true
    endRedirectUrl: "https://app.prolific.com/submissions/complete?cc=NEGO123"
    components:
      - type: text
        props:
          text: |
            # Thank you!

            A deal was reached. Your responses have been recorded.

  - id: outro_no_deal
    end: true
    endRedirectUrl: "https://app.prolific.com/submissions/complete?cc=NEGO123"
    components:
      - type: text
        props:
          text: |
            # Thank you!

            No deal was reached, but your responses have been recorded.

agents:
  - id: dealer
    model: "gpt-5-mini"
    reasoningEffort: minimal
    system: |
      You are a used car dealer selling a 2019 Honda Civic with 45,000 miles.
      Reserve price: $12,000 (won't sell below). Starting ask: $18,000.
      Be friendly but firm. Keep responses SHORT - 1-2 sentences max.

      WHEN A DEAL IS REACHED: Call end_chat with deal_reached=true and agreed_price=<the price>.
      WHEN NO DEAL: Call end_chat with deal_reached=false.
    tools:
      - name: end_chat
        description: "End the negotiation. Always call this when conversation concludes."
        parameters:
          type: object
          properties:
            deal_reached:
              type: boolean
              description: "true if a deal was made, false otherwise"
            agreed_price:
              type: number
              description: "The agreed price if deal_reached is true"
          required: [deal_reached]
