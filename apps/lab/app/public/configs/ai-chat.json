{
  "schema_version": "0.1.0",
  "initialPageId": "intro",
  "nodes": [
    {
      "id": "intro",
      "components": [
        {
          "type": "text",
          "props": {
            "text": "# Negotiation Study\n\nYou will negotiate the price of a used car with an AI assistant.\nTry to get the best deal you can. The AI has a reserve price it won't go below.\n"
          }
        },
        {
          "type": "buttons",
          "props": {
            "buttons": [
              {
                "id": "start",
                "text": "Start negotiation",
                "action": {
                  "type": "go_to",
                  "target": "chat"
                }
              }
            ]
          }
        }
      ]
    },
    {
      "id": "chat",
      "components": [
        {
          "type": "chat",
          "props": {
            "agents": [
              "dealer"
            ]
          }
        },
        {
          "type": "buttons",
          "props": {
            "buttons": [
              {
                "id": "end_chat",
                "text": "End negotiation",
                "highlightWhen": "chat_ended",
                "action": {
                  "type": "go_to",
                  "target": "post_survey"
                }
              }
            ]
          }
        }
      ]
    },
    {
      "id": "post_survey",
      "components": [
        {
          "type": "survey",
          "props": {
            "items": [
              {
                "id": "final_price",
                "text": "What was the final agreed price (if any)?",
                "answer": "numeric"
              },
              {
                "id": "satisfaction",
                "text": "How satisfied are you with the outcome?",
                "answer": "likert5"
              },
              {
                "id": "strategy",
                "text": "Describe your negotiation strategy.",
                "answer": "text"
              }
            ]
          }
        },
        {
          "type": "buttons",
          "props": {
            "buttons": [
              {
                "id": "finish",
                "text": "Finish",
                "action": {
                  "type": "go_to",
                  "branches": [
                    {
                      "when": "user_state.deal_reached == true",
                      "target": "outro_deal"
                    },
                    {
                      "target": "outro_no_deal"
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    },
    {
      "id": "outro_deal",
      "end": true,
      "endRedirectUrl": "https://app.prolific.com/submissions/complete?cc=NEGO123",
      "components": [
        {
          "type": "text",
          "props": {
            "text": "# Thank you!\n\nA deal was reached. Your responses have been recorded.\n"
          }
        }
      ]
    },
    {
      "id": "outro_no_deal",
      "end": true,
      "endRedirectUrl": "https://app.prolific.com/submissions/complete?cc=NEGO123",
      "components": [
        {
          "type": "text",
          "props": {
            "text": "# Thank you!\n\nNo deal was reached, but your responses have been recorded.\n"
          }
        }
      ]
    }
  ],
  "agents": [
    {
      "id": "dealer",
      "model": "gpt-5-mini",
      "reasoningEffort": "minimal",
      "system": "You are a used car dealer selling a 2019 Honda Civic with 45,000 miles.\nReserve price: $12,000 (won't sell below). Starting ask: $18,000.\nBe friendly but firm. Keep responses SHORT - 1-2 sentences max.\n\nWHEN A DEAL IS REACHED: Call end_chat with deal_reached=true and agreed_price=<the price>.\nWHEN NO DEAL: Call end_chat with deal_reached=false.\n",
      "tools": [
        {
          "name": "end_chat",
          "description": "End the negotiation. Always call this when conversation concludes.",
          "parameters": {
            "type": "object",
            "properties": {
              "deal_reached": {
                "type": "boolean",
                "description": "true if a deal was made, false otherwise"
              },
              "agreed_price": {
                "type": "number",
                "description": "The agreed price if deal_reached is true"
              }
            },
            "required": [
              "deal_reached"
            ]
          }
        }
      ]
    }
  ]
}