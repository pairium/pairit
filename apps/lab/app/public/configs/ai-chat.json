{
  "schema_version": "0.1.0",
  "initialPageId": "intro",
  "nodes": [
    {
      "id": "intro",
      "components": [
        {
          "type": "text",
          "props": {
            "text": "# Negotiation Study\n\nYou will negotiate the price of a used car with an AI assistant.\nTry to get the best deal you can. The AI has a reserve price it won't go below.\n"
          }
        },
        {
          "type": "buttons",
          "props": {
            "buttons": [
              {
                "id": "start",
                "text": "Start negotiation",
                "action": {
                  "type": "go_to",
                  "target": "chat"
                }
              }
            ]
          }
        }
      ]
    },
    {
      "id": "chat",
      "components": [
        {
          "type": "chat",
          "props": {
            "agents": [
              "dealer"
            ]
          }
        },
        {
          "type": "buttons",
          "props": {
            "buttons": [
              {
                "id": "end_chat",
                "text": "End negotiation",
                "action": {
                  "type": "go_to",
                  "target": "post_survey"
                }
              }
            ]
          }
        }
      ]
    },
    {
      "id": "post_survey",
      "components": [
        {
          "type": "survey",
          "props": {
            "items": [
              {
                "id": "final_price",
                "text": "What was the final agreed price (if any)?",
                "answer": "numeric"
              },
              {
                "id": "satisfaction",
                "text": "How satisfied are you with the outcome?",
                "answer": "likert5"
              },
              {
                "id": "strategy",
                "text": "Describe your negotiation strategy.",
                "answer": "text"
              }
            ]
          }
        },
        {
          "type": "buttons",
          "props": {
            "buttons": [
              {
                "id": "finish",
                "text": "Finish",
                "action": {
                  "type": "go_to",
                  "branches": [
                    {
                      "when": "user_state.deal_reached == true",
                      "target": "outro_deal"
                    },
                    {
                      "target": "outro_no_deal"
                    }
                  ]
                }
              }
            ]
          }
        }
      ]
    },
    {
      "id": "outro_deal",
      "end": true,
      "endRedirectUrl": "https://app.prolific.com/submissions/complete?cc=NEGO123",
      "components": [
        {
          "type": "text",
          "props": {
            "text": "# Thank you!\n\nA deal was reached. Your responses have been recorded.\n"
          }
        }
      ]
    },
    {
      "id": "outro_no_deal",
      "end": true,
      "endRedirectUrl": "https://app.prolific.com/submissions/complete?cc=NEGO123",
      "components": [
        {
          "type": "text",
          "props": {
            "text": "# Thank you!\n\nNo deal was reached, but your responses have been recorded.\n"
          }
        }
      ]
    }
  ],
  "agents": [
    {
      "id": "dealer",
      "model": "gpt-4o-mini",
      "system": "You are a used car dealer. The car is a 2019 Honda Civic with 45,000 miles.\nYour reserve price is $12,000 â€” you will not sell below this.\nYour starting ask is $18,000.\nBe friendly but firm. Use negotiation tactics.\nIf the buyer agrees to a price at or above $12,000, use assign_state to record the agreed price and that a deal was reached, then use end_chat.\n",
      "tools": [
        {
          "name": "end_chat",
          "description": "End the negotiation. Disables chat and prompts participant to continue."
        },
        {
          "name": "assign_state",
          "description": "Write a value to the participant's user_state.",
          "parameters": {
            "type": "object",
            "properties": {
              "path": {
                "type": "string"
              },
              "value": {}
            },
            "required": [
              "path",
              "value"
            ]
          }
        }
      ]
    }
  ]
}