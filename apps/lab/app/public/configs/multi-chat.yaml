# Config: Multi-Chat Demo
# Tests: P0-16 (Chat groupId scoping)
# Demonstrates: Isolated vs shared chat memory patterns

schema_version: 0.1.0
allowRetake: true
initialPageId: intro

pages:
  - id: intro
    components:
      - type: text
        props:
          text: |
            # Multi-Chat Demo

            This experiment demonstrates chat groupId scoping:
            - **Isolated chats**: Each page has separate message history (default)
            - **Shared chats**: Multiple pages share the same conversation

      - type: buttons
        props:
          buttons:
            - id: start
              text: "Start Demo"
              action:
                type: go_to
                target: chat_1

  # --- SHARED CHAT PAGES ---
  # These two pages share the same groupId, so messages persist across them

  - id: chat_1
    components:
      - type: text
        props:
          text: |
            ## Round 1: Financial Advisor

            This chat uses `groupId: "consultation"`. Messages will carry over to Round 2.

      - type: chat
        props:
          groupId: "consultation"
          agents:
            - advisor
          placeholder: "Ask about investment strategies..."

      - type: buttons
        props:
          buttons:
            - id: next
              text: "Continue to Round 2"
              action:
                type: go_to
                target: chat_2

  - id: chat_2
    components:
      - type: text
        props:
          text: |
            ## Round 2: Same Advisor (Shared Memory)

            Same `groupId: "consultation"` - the advisor remembers Round 1 conversation.

      - type: chat
        props:
          groupId: "consultation"
          agents:
            - advisor
          placeholder: "Continue the conversation..."

      - type: buttons
        props:
          buttons:
            - id: next
              text: "Try Isolated Chat"
              action:
                type: go_to
                target: chat_isolated

  # --- ISOLATED CHAT PAGE ---
  # No groupId prop = isolated by default (uses session:pageId)

  - id: chat_isolated
    components:
      - type: text
        props:
          text: |
            ## Isolated Chat

            No `groupId` prop - this chat is isolated to this page only.
            Messages here won't appear on other pages.

      - type: chat
        props:
          agents:
            - advisor
          placeholder: "Start a fresh conversation..."

      - type: buttons
        props:
          buttons:
            - id: finish
              text: "Finish Demo"
              action:
                type: go_to
                target: outro

  - id: outro
    end: true
    components:
      - type: text
        props:
          text: |
            # Demo Complete

            You've seen how `groupId` controls chat memory:
            - **Explicit groupId**: Share messages across pages
            - **No groupId**: Isolated per-page history (default)

agents:
  - id: advisor
    model: "gpt-5-mini"
    reasoningEffort: minimal
    system: |
      You are a friendly financial advisor. Give brief, helpful responses.
      If the user has spoken to you before in this session, acknowledge the prior conversation.
      Keep responses SHORT - 2-3 sentences max.
